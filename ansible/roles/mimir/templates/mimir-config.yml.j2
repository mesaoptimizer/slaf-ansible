# Mimir single-binary mode configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

target: all

multitenancy_enabled: false

common:
  storage:
    backend: s3
    s3:
      bucket_name: "{{ mimir_s3_bucket }}"
      endpoint: "{{ s3_endpoint }}"
      region: "{{ s3_region }}"
      access_key_id: "{{ mimir_s3_access_key }}"
      secret_access_key: "{{ mimir_s3_secret_key }}"
      insecure: {{ s3_insecure | default(false) | lower }}
{% if s3_skip_verify | default(false) %}
      http:
        insecure_skip_verify: {{ s3_skip_verify | lower }}
{% endif %}

blocks_storage:
  tsdb:
    dir: {{ mimir_tsdb_dir }}
    # Keep 13 hours of data locally before shipping to S3
    retention_period: 13h
    # Ship blocks to S3 every 1 minute
    ship_interval: 1m
  bucket_store:
    sync_dir: {{ mimir_data_dir }}/tsdb-sync

ingester:
  ring:
    replication_factor: 1
    kvstore:
      store: inmemory

distributor:
  ring:
    kvstore:
      store: inmemory

compactor:
  compaction_interval: 30m
  data_dir: {{ mimir_data_dir }}/compactor
  deletion_delay: 2h
  cleanup_interval: 1h

limits:
  # Default limits for single-tenant mode
  ingestion_rate: 100000
  ingestion_burst_size: 200000
  # Retention period (7 days = 168 hours)
  compactor_blocks_retention_period: 168h

server:
  http_listen_port: {{ mimir_http_port }}
  grpc_listen_port: {{ mimir_grpc_port }}
  log_format: json

activity_tracker:
  filepath: {{ mimir_data_dir }}/metrics-activity.log

alertmanager_storage:
  backend: local
  local:
    path: {{ mimir_data_dir }}/alertmanager
