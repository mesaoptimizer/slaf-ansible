# Mimir single-binary mode configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

multitenancy_enabled: false

ingester:
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
    num_tokens: 128
    heartbeat_timeout: 5m
    heartbeat_interval: 5s
  max_series_per_metric: 0
  max_global_series_per_user: 0

blocks_storage:
  backend: s3
  tsdb:
    dir: {{ mimir_tsdb_dir }}
    # Keep 13 hours of data locally before shipping to S3
    retention_period: 13h
    # Ship blocks to S3 every 1 minute
    ship_interval: 1m
  bucket_store:
    sync_interval: 15m
  s3:
    bucket_name: "{{ mimir_s3_bucket }}"
    endpoint: "{{ s3_endpoint }}"
    region: "{{ s3_region }}"
    access_key_id: "{{ mimir_s3_access_key }}"
    secret_access_key: "{{ mimir_s3_secret_key }}"
    insecure: {{ s3_insecure | default(false) | lower }}
    {% if s3_skip_verify | default(false) %}
    # For self-signed certs with Garage
    http:
      insecure_skip_verify: {{ s3_skip_verify | lower }}
    {% endif %}

distributor:
  ring:
    kvstore:
      store: inmemory

compactor:
  compaction_interval: 30m
  data_dir: {{ mimir_data_dir }}/compactor
  # Auto-delete blocks older than 7 days
  blocks_retention_period: 168h
  cleanup_interval: 1h

querier:
  cache_results: true
  cache_results_ttl: 1m

limits:
  # Default limits for single-tenant mode
  max_series_per_user: 0
  max_global_series_per_user: 0
  max_metric_metadata_per_user: 0
  ingestion_rate: 100000
  ingestion_burst_size: 200000
  max_samples_per_second: 0
  # Retention period (7 days = 168 hours)
  compactor_blocks_retention_period: 168h

server:
  http_listen_port: {{ mimir_http_port }}
  grpc_listen_port: {{ mimir_grpc_port }}
  grpc_server_max_recv_msg_size: 104857600
  grpc_server_max_send_msg_size: 104857600
  log_format: json

# Store gateway
store_gateway:
  sharding_enabled: false

# Runtime configuration
runtime:
  file: {{ mimir_data_dir }}/runtime.yml
  period: 10s
