#!/sbin/openrc-run
# OpenRC init script for Loki
# Generated by Ansible

description="Loki log aggregation system"
command="/usr/local/bin/loki"
command_args="-config.file=/etc/loki/loki-config.yml"
command_user="loki:loki"
directory="{{ loki_data_dir }}"
pidfile="/run/loki.pid"
logfile="/var/log/loki.log"

depend() {
	need net
}

start() {
	ebegin "Starting Loki"
	start-stop-daemon --start \
		--user "$command_user" \
		--pidfile "$pidfile" \
		--background \
		--make-pidfile \
		--stdout "$logfile" \
		--stderr "$logfile" \
		--exec $command \
		-- $command_args
	eend $?
}

stop() {
	ebegin "Stopping Loki"
	start-stop-daemon --stop \
		--pidfile "$pidfile" \
		--exec $command
	eend $?
}

restart() {
	stop
	sleep 1
	start
}
