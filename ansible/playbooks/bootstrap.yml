---
- name: Bootstrap hosts
  hosts: homelab
  gather_facts: false
  tasks:
    - name: Install Python and essentials on Alpine
      ansible.builtin.raw: apk add --no-cache --no-progress python3 py3-pip curl wget
      register: apk_install
      changed_when: "'Installing' in apk_install.stdout or 'Upgrading' in apk_install.stdout"

    - name: Gather facts
      ansible.builtin.setup:

    - name: Ping hosts
      ansible.builtin.ping:

    - name: Update system packages
      community.general.apk:
        update_cache: true
        upgrade: true